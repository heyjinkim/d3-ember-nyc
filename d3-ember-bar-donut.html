<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="libs/d3.min.js"></script>
  <script src="libs/jquery-1.10.2.js"></script>
  <script src="libs/handlebars-1.1.2.js"></script>
  <script src="libs/ember-1.5.1.js"></script>
  <script src="js/data.js"></script>
  <link rel="stylesheet" href="css/d3.css">
  <title>Reusable D3 charts with Ember.js Components</title>
</head>

<body>

  <script type="text/x-handlebars" id="application">
    {{bar-chart width=960 height=500 data=content class="big"}}
    {{donut-chart width=200 height=200 data=content class="cream"}}
  </script>

  <script type="text/x-handlebars" id="components/bar-chart">
    <g class="wrapper" {{bindAttr transform=transform}}>
      <g class="x axis"></g>
      <g class="y axis">
        <text transform="rotate(-90)" y="6" dy=".71em" style="text-anchor:end;">Frequency</text>
      </g>
    </g>
  </script>

  <script type="text/x-handlebars" id="components/donut-chart">
    <g {{bind-attr transform=transform}}></g>
  </script>

  <script>
    App = Ember.Application.create();

    App.ApplicationController = Ember.ArrayController.extend({
      content: Ember.A(DATA),
      content2: Ember.A(DATA2)
    });

    App.BarChartComponent = Ember.Component.extend({
      tagName: 'svg',
      attributeBindings: 'width height'.w(),
      margin: {top: 20, right: 20, bottom: 30, left: 40},

      _width: function(){
        return this.get('width') - this.margin.left - this.margin.right;
      }.property('width'),

      _height: function(){
        return this.get('height') - this.margin.top - this.margin.bottom;
      }.property('height'),

      transform: function(){
        return 'translate(' + this.margin.left + ',' + this.margin.top + ')';
      }.property(),

      d3code: function(){
        var width = this.get('_width');
        var height = this.get('_height');
        var data = this.get('data');
        var svg = d3.select('#'+this.get('elementId'));

        var x = d3.scale.ordinal().rangeRoundBands([0, width], 0.1);
        var y = d3.scale.linear().range([height, 0]);
        var xAxis = d3.svg.axis().scale(x).orient('bottom');
        var yAxis = d3.svg.axis().scale(y).orient('left');

        x.domain(data.map(function(d) { return d.letter; }));
        y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

        svg.select('.axis.x')
          .attr('transform', 'translate(0,' + height + ')')
          .call(xAxis);

        svg.select('.axis.y').call(yAxis);

        svg.select('.wrapper').selectAll('rect')
          .data(data)
        .enter().append('rect')
          .attr('class', 'bar')
          .attr('x', function(d) { return x(d.letter); })
          .attr('width', x.rangeBand())
          .attr('y', function(d) { return y(d.frequency); })
          /* ----  add class name on bar ----*/
          .attr('class', function(d) { return d.letter; })
          /* ----  add class name on bar ----*/
          .attr('height', function(d) { return height - y(d.frequency); });
      }.on('didInsertElement')
    });

    App.DonutChartComponent = Ember.Component.extend({
      tagName: 'svg',
      attributeBindings: 'width height'.w(),

      transform: function(){
        return 'translate(' + this.get('width')/2 + ',' + this.get('height')/2 + ')';
      }.property('width', 'height'),

      d3code: function() {
        var radius = Math.min(this.get('width'), this.get('height')) / 2;

        var arc = d3.svg.arc()
            .outerRadius(radius)
            .innerRadius(radius-15);

        var pie = d3.layout.pie()
            .sort(null)
            .value(function(d) { return d.frequency; });

        var svg = d3.select('#'+this.get('elementId')).select('g');

        var g = svg.selectAll('.arc')
           .data(pie(this.get('data'))).enter()
          .append('g')
           .attr('class', 'arc');

        g.append('path')
          .attr('d', arc)
          .attr('class', function(d, i) { return d.data.letter; });
      }.on('didInsertElement')
    });
  </script>
</body>
</html>